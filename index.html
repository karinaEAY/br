<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <!-- –ó–∞–ø—Ä–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–∞—Å–∞–Ω–∏–π -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Brainrot Items Generator - Holiday Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    
    <style>
        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∑–∞–ø—Ä–µ—Ç –∑—É–º–∞ */
        * {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(-45deg, #0f172a, #1e293b, #0f172a, #1e1b4b);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://i.ytimg.com/vi/C2kErvkXsC4/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLAXvguaVXHq2I3KmJQmXZFD6jazTQ');
            background-size: cover;
            background-position: center;
            z-index: -2;
            will-change: transform;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 15, 30, 0.85);
            z-index: -1;
        }

        /* –°–Ω–µ–∂–∏–Ω–∫–∏ */
        .snowflake {
            color: #fff;
            font-size: 1.2em;
            position: fixed;
            top: -10%;
            z-index: 5;
            pointer-events: none;
            animation: snowflakes-fall 10s linear infinite, snowflakes-shake 3s ease-in-out infinite;
            will-change: top, transform;
        }

        @keyframes snowflakes-fall {
            0% { top: -10%; }
            100% { top: 110%; }
        }

        @keyframes snowflakes-shake {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(50px); }
        }

        /* –ì–∏—Ä–ª—è–Ω–¥–∞ */
        .garland {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            z-index: 30;
            pointer-events: none;
            display: flex;
            justify-content: space-around;
        }

        .light {
            width: 12px;
            height: 18px;
            border-radius: 50%;
            animation: flash 1.2s infinite;
        }

        .light:nth-child(4n+1) { background: #ff4d4d; box-shadow: 0 0 15px #ff4d4d; animation-delay: 0.1s; }
        .light:nth-child(4n+2) { background: #4dff4d; box-shadow: 0 0 15px #4dff4d; animation-delay: 0.4s; }
        .light:nth-child(4n+3) { background: #ffff4d; box-shadow: 0 0 15px #ffff4d; animation-delay: 0.7s; }
        .light:nth-child(4n+4) { background: #4d4dff; box-shadow: 0 0 15px #4d4dff; animation-delay: 1s; }

        @keyframes flash {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .fruit-card {
            transition: transform 0.2s cubic-bezier(0.17, 0.67, 0.83, 0.67), box-shadow 0.2s ease, border-color 0.2s ease;
            will-change: transform, box-shadow;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .fruit-card:active {
            transform: scale(0.96);
        }

        .fruit-card.selected {
            border-color: #fbbf24;
            background: rgba(0, 0, 0, 0.6);
        }

        /* –¢–µ–Ω–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .fruit-card[data-fruit="Rebirth"].selected { box-shadow: 0 0 30px rgba(255, 255, 255, 0.7); }
        .fruit-card[data-fruit="Los Spyderinis"].selected { box-shadow: 0 0 25px rgba(59, 130, 246, 0.6); }
        .fruit-card[data-fruit="Strawberry Elephant"].selected { box-shadow: 0 0 25px rgba(236, 72, 153, 0.6); }
        .fruit-card[data-fruit="Cannelloni with Dragon"].selected { box-shadow: 0 0 25px rgba(132, 204, 22, 0.6); }

        .neon-text {
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.8), 0 0 20px rgba(34, 197, 94, 0.4);
        }

        .flying-img {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            /* –ó–∞–º–µ–¥–ª–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è: 1.5 —Å–µ–∫—É–Ω–¥—ã */
            transition: all 1.5s cubic-bezier(0.19, 1, 0.22, 1);
            border-radius: 50%;
        }

        @keyframes jiggle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .jiggle { animation: jiggle 0.3s ease-out; }

        /* –û–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .card-img-container {
            width: 100%;
            height: 60%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .modal { display: none; }
        .modal.visible { display: flex; }
    </style>
</head>
<body class="text-white antialiased">

    <!-- –ì–∏—Ä–ª—è–Ω–¥–∞ -->
    <div class="garland">
        <script>
            for(let i=0; i<20; i++) document.write('<div class="light"></div>');
        </script>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–Ω–µ–≥–∞ -->
    <div id="snowContainer"></div>

    <div class="relative w-full min-h-screen flex flex-col">
        <div class="flex-grow relative z-10">
            <div class="container mx-auto px-4 py-12 pb-48 flex flex-col items-center">
                
                <div class="bg-black/50 backdrop-blur-md rounded-2xl py-4 px-10 mb-8 border-2 border-green-500/50 text-center">
                    <p class="text-sm text-green-400 font-bold mb-1 uppercase tracking-widest">üéÑ Holiday Brainrot Edition üéÑ</p>
                    <h2 class="text-3xl sm:text-4xl font-black text-white uppercase tracking-tighter">STEAL A BRAINROT</h2>
                </div>

                <h1 class="text-3xl sm:text-4xl font-black mb-12 text-center text-green-500 uppercase tracking-widest neon-text">ITEMS GENERATOR</h1>

                <!-- –°–µ—Ç–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ -->
                <div id="fruitGrid" class="grid grid-cols-2 gap-6 md:gap-8 max-w-4xl w-full">
                    
                    <!-- 1. Rebirth -->
                    <div class="fruit-card bg-black/40 backdrop-blur-md rounded-2xl p-6 border-2 border-white/10 aspect-square cursor-pointer" data-fruit="Rebirth">
                        <div class="card-img-container">
                            <img src="https://i.ibb.co/cSPKf7QG/Chat-GPT-Image-26-2025-14-52-08.jpg" alt="Rebirth" class="max-h-full max-w-full object-contain drop-shadow-2xl rounded-full" loading="lazy">
                        </div>
                        <p class="font-bold text-center text-lg sm:text-xl uppercase tracking-tight py-2">Rebirth</p>
                        <div class="w-full flex flex-col items-center gap-3">
                            <div class="quantity-selector hidden flex items-center justify-center gap-4">
                                <button class="quantity-btn minus-btn bg-red-600/60 rounded-lg w-10 h-10 font-bold">-</button>
                                <span class="quantity-value text-2xl font-black w-8 text-center">1</span>
                                <button class="quantity-btn plus-btn bg-green-600/60 rounded-lg w-10 h-10 font-bold">+</button>
                            </div>
                            <button class="claim-btn w-full text-lime-400 font-black py-3 rounded-xl border-2 border-lime-400/50 bg-lime-500/10 uppercase transition-colors">Collect</button>
                        </div>
                    </div>

                    <!-- 2. Los Spyderinis -->
                    <div class="fruit-card bg-black/40 backdrop-blur-md rounded-2xl p-6 border-2 border-white/10 aspect-square cursor-pointer" data-fruit="Los Spyderinis">
                        <div class="card-img-container">
                            <img src="https://cdn.salla.sa/cdn-cgi/image/fit=scale-down,width=450,height=450,onerror=redirect,format=webp/jDznl/ffe45f6d-30a2-47f0-aec2-49b9d1d94116-1000x1000-Lp6lkpqNlGfBm6boa894ifaRYVzw4C4GmSUZ69Mv.png" alt="Los Spyderinis" class="max-h-full max-w-full object-contain drop-shadow-2xl" loading="lazy">
                        </div>
                        <p class="font-bold text-center text-lg sm:text-xl uppercase tracking-tight py-2">Los Spyderinis</p>
                        <div class="w-full flex flex-col items-center gap-3">
                            <div class="quantity-selector hidden flex items-center justify-center gap-4">
                                <button class="quantity-btn minus-btn bg-red-600/60 rounded-lg w-10 h-10 font-bold">-</button>
                                <span class="quantity-value text-2xl font-black w-8 text-center">1</span>
                                <button class="quantity-btn plus-btn bg-green-600/60 rounded-lg w-10 h-10 font-bold">+</button>
                            </div>
                            <button class="claim-btn w-full text-lime-400 font-black py-3 rounded-xl border-2 border-lime-400/50 bg-lime-500/10 uppercase">Collect</button>
                        </div>
                    </div>

                    <!-- 3. Strawberry Elephant -->
                    <div class="fruit-card bg-black/40 backdrop-blur-md rounded-2xl p-6 border-2 border-white/10 aspect-square cursor-pointer" data-fruit="Strawberry Elephant">
                        <div class="card-img-container">
                            <img src="https://tr.rbxcdn.com/180DAY-d51e304283960ef3ab603c45023b98d5/420/420/Hat/Webp/noFilter" alt="Strawberry Elephant" class="max-h-full max-w-full object-contain drop-shadow-2xl" loading="lazy">
                        </div>
                        <p class="font-bold text-center text-lg sm:text-xl uppercase tracking-tight py-2">Strawberry Elephant</p>
                        <div class="w-full flex flex-col items-center gap-3">
                            <div class="quantity-selector hidden flex items-center justify-center gap-4">
                                <button class="quantity-btn minus-btn bg-red-600/60 rounded-lg w-10 h-10 font-bold">-</button>
                                <span class="quantity-value text-2xl font-black w-8 text-center">1</span>
                                <button class="quantity-btn plus-btn bg-green-600/60 rounded-lg w-10 h-10 font-bold">+</button>
                            </div>
                            <button class="claim-btn w-full text-lime-400 font-black py-3 rounded-xl border-2 border-lime-400/50 bg-lime-500/10 uppercase">Collect</button>
                        </div>
                    </div>

                    <!-- 4. Cannelloni with Dragon -->
                    <div class="fruit-card bg-black/40 backdrop-blur-md rounded-2xl p-6 border-2 border-white/10 aspect-square cursor-pointer" data-fruit="Cannelloni with Dragon">
                        <div class="card-img-container">
                            <img src="https://cdn.shopify.com/s/files/1/0837/8712/0919/files/ChatGPT_Image_Aug_8__2025__06_55_02_PM-removebg-preview_600x600.png.webp?v=1754675721" alt="Dragon" class="max-h-full max-w-full object-contain drop-shadow-2xl" loading="lazy">
                        </div>
                        <p class="font-bold text-center text-lg sm:text-xl uppercase tracking-tight py-2">Cannelloni with Dragon</p>
                        <div class="w-full flex flex-col items-center gap-3">
                            <div class="quantity-selector hidden flex items-center justify-center gap-4">
                                <button class="quantity-btn minus-btn bg-red-600/60 rounded-lg w-10 h-10 font-bold">-</button>
                                <span class="quantity-value text-2xl font-black w-8 text-center">1</span>
                                <button class="quantity-btn plus-btn bg-green-600/60 rounded-lg w-10 h-10 font-bold">+</button>
                            </div>
                            <button class="claim-btn w-full text-lime-400 font-black py-3 rounded-xl border-2 border-lime-400/50 bg-lime-500/10 uppercase">Collect</button>
                        </div>
                    </div>

                    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã —á–µ—Ä–µ–∑ —Ü–∏–∫–ª -->
                    <script>
                        const items = [
                            { name: "La Spooky Grande", img: "https://i.ibb.co/q3q61QfJ/IMG-1363.webp" },
                            { name: "Spooky and Pumpky", img: "https://i.ibb.co/5WZycTrn/IMG-1364.webp" },
                            { name: "Vampira Cappucina", img: "https://i.ibb.co/1pNYNZw/IMG-1365.webp" },
                            { name: "Zombie Tralala", img: "https://i.ibb.co/N6C5GmrH/IMG-1366.webp" },
                            { name: "Frankentteo", img: "https://i.ibb.co/cz1r6bD/IMG-1367.webp" },
                            { name: "La Vacca Jacko Lanterino", img: "https://i.ibb.co/mVVv7nkt/IMG-1368.webp" },
                            { name: "Eviledon", img: "https://i.ibb.co/hxBxz12f/IMG-1369.webp" },
                            { name: "Vulturino Skeletono", img: "https://i.ibb.co/h1sC72dv/IMG-1370.webp" },
                            { name: "Los Mobilis", img: "https://i.ibb.co/x8mSSK0T/IMG-1371.webp" },
                            { name: "Mieteteira Bicicleteira", img: "https://i.ibb.co/G4zfZDrq/IMG-1372.webp" }
                        ];

                        items.forEach(item => {
                            document.write(`
                                <div class="fruit-card bg-black/30 backdrop-blur-sm rounded-2xl p-6 border-2 border-white/10 aspect-square cursor-pointer" data-fruit="${item.name}">
                                    <div class="card-img-container">
                                        <img src="${item.img}" alt="${item.name}" class="max-h-full max-w-full object-contain drop-shadow-lg" loading="lazy">
                                    </div>
                                    <p class="font-semibold text-center text-lg sm:text-xl tracking-tight py-2">${item.name}</p>
                                    <div class="w-full flex flex-col items-center gap-3">
                                        <div class="quantity-selector hidden flex items-center justify-center gap-4">
                                            <button class="quantity-btn minus-btn bg-red-600/60 rounded-md w-8 h-8 font-bold">-</button>
                                            <span class="quantity-value text-xl font-bold w-6 text-center">1</span>
                                            <button class="quantity-btn plus-btn bg-green-600/60 rounded-md w-8 h-8 font-bold">+</button>
                                        </div>
                                        <button class="claim-btn w-full text-lime-400 font-bold py-2 rounded-lg border border-lime-400/50 bg-lime-500/10">Collect</button>
                                    </div>
                                </div>
                            `);
                        });
                    </script>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ Continue -->
        <div id="continueSection" class="fixed bottom-0 left-0 right-0 p-6 bg-gray-900/90 backdrop-blur-md border-t border-white/20 z-20">
            <div class="max-w-md mx-auto">
                <button id="continueButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-black py-5 px-8 rounded-2xl shadow-2xl flex items-center justify-center text-xl uppercase tracking-widest transition-all">
                    <span>Continue</span>
                    <div class="relative ml-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707l-2.414-2.414A1 1 0 006.586 13H4" />
                        </svg>
                        <span id="cartCount" class="absolute -top-3 -right-4 bg-white text-red-700 text-sm rounded-full h-7 w-7 flex items-center justify-center font-black border-2 border-red-700">0</span>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ù–∏–∫–Ω–µ–π–º–∞ -->
    <div id="nicknameModal" class="modal fixed inset-0 bg-black/80 items-center justify-center z-40 backdrop-blur-md p-6">
        <div class="w-full max-w-lg text-center">
            <div class="bg-gray-800/90 rounded-3xl p-10 border-4 border-red-500 shadow-2xl relative">
                <button id="closeNicknameModal" class="absolute top-4 right-6 text-gray-400 hover:text-white text-5xl leading-none">&times;</button>
                <h2 class="text-3xl font-black mb-6 text-red-500 uppercase">Holiday Spirit!</h2>
                <div id="selectedItemsContainer" class="flex flex-wrap justify-center gap-4 mb-8 min-h-[80px]"></div>
                <input id="nicknameInput" type="text" placeholder="Epic Nickname" class="w-full bg-gray-700 border-2 border-gray-600 rounded-2xl px-6 py-4 text-center text-xl text-white outline-none focus:border-red-500 transition-all">
                <button id="generateButton" class="mt-8 w-full bg-green-600 hover:bg-green-700 text-white font-black py-5 rounded-2xl text-2xl uppercase tracking-widest">Generate Gifts</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingModal" class="modal fixed inset-0 bg-black/95 items-center justify-center z-50">
        <div class="text-center">
            <div class="w-20 h-20 border-8 border-red-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <p class="text-2xl font-black uppercase tracking-widest">Packing Holiday Brainrot...</p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å–ø–µ—Ö–∞ -->
    <div id="doneModal" class="modal fixed inset-0 bg-black/80 items-center justify-center z-50 p-6">
        <div class="bg-gray-800 rounded-3xl p-12 text-center border-4 border-green-500 max-w-md">
            <div class="text-7xl mb-6">üéÑüéÅ‚ùÑÔ∏è</div>
            <h2 class="text-4xl font-black mb-4 uppercase text-green-500">Delivered!</h2>
            <p class="text-gray-200 text-xl mb-8 leading-relaxed">Generated! Check your account now!</p>
            <button id="closeModalButton" class="bg-red-600 hover:bg-red-700 text-white font-black py-4 px-12 text-2xl rounded-2xl uppercase tracking-widest shadow-lg">Merry Christmas!</button>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–µ–≥–∞
        const createSnowflakes = () => {
            const container = document.getElementById('snowContainer');
            const icons = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
            for (let i = 0; i < 40; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = icons[Math.floor(Math.random() * icons.length)];
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDelay = Math.random() * 10 + 's, ' + Math.random() * 3 + 's';
                snowflake.style.opacity = Math.random() * 0.7 + 0.3;
                container.appendChild(snowflake);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            createSnowflakes();
            
            const fruitCards = document.querySelectorAll('.fruit-card');
            const continueBtn = document.getElementById('continueButton');
            const nicknameModal = document.getElementById('nicknameModal');
            const closeNicknameModal = document.getElementById('closeNicknameModal');
            const generateBtn = document.getElementById('generateButton');
            const nicknameInput = document.getElementById('nicknameInput');
            const doneModal = document.getElementById('doneModal');
            const closeModalBtn = document.getElementById('closeModalButton');
            const cartCount = document.getElementById('cartCount');
            const selectedItemsContainer = document.getElementById('selectedItemsContainer');
            const loadingModal = document.getElementById('loadingModal');

            let cart = [];

            const updateCartUI = () => {
                const total = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = total;
            };

            const flyToCart = (card) => {
                const img = card.querySelector('img');
                const target = document.getElementById('cartCount');
                if (!img || !target) return;

                const rect = img.getBoundingClientRect();
                const targetRect = target.getBoundingClientRect();
                const flyer = img.cloneNode();
                
                Object.assign(flyer.style, {
                    position: 'fixed',
                    top: rect.top + 'px',
                    left: rect.left + 'px',
                    width: rect.width + 'px',
                    height: rect.height + 'px',
                    opacity: '1',
                    zIndex: '10000',
                    // –£–≤–µ–ª–∏—á–µ–Ω–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–æ 1.5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª–µ—Ç–∞
                    transition: 'all 1.5s cubic-bezier(0.19, 1, 0.22, 1)',
                    pointerEvents: 'none'
                });

                document.body.appendChild(flyer);

                // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM
                setTimeout(() => {
                    Object.assign(flyer.style, {
                        top: (targetRect.top + 5) + 'px',
                        left: (targetRect.left + 5) + 'px',
                        width: '20px',
                        height: '20px',
                        opacity: '0.3',
                        transform: 'scale(0.2)'
                    });
                }, 50);

                flyer.addEventListener('transitionend', () => {
                    flyer.remove();
                    continueBtn.classList.add('jiggle');
                    setTimeout(() => continueBtn.classList.remove('jiggle'), 300);
                });
            };

            fruitCards.forEach(card => {
                const name = card.dataset.fruit;
                const selector = card.querySelector('.quantity-selector');
                const qValue = card.querySelector('.quantity-value');
                let count = 1;

                card.addEventListener('click', (e) => {
                    if (e.target.closest('button')) return;
                    if (card.classList.contains('active-selection')) {
                        card.classList.remove('active-selection', 'selected');
                        selector.classList.add('hidden');
                        cart = cart.filter(i => i.name !== name);
                        updateCartUI();
                    } else {
                        card.classList.add('active-selection');
                        selector.classList.remove('hidden');
                    }
                });

                card.querySelector('.claim-btn').addEventListener('click', () => {
                    if (selector.classList.contains('hidden')) {
                        card.classList.add('active-selection');
                        selector.classList.remove('hidden');
                        return;
                    }
                    card.classList.add('selected');
                    const existing = cart.find(i => i.name === name);
                    if (existing) existing.quantity = count;
                    else cart.push({ name, quantity: count });
                    flyToCart(card);
                    updateCartUI();
                });

                card.querySelector('.minus-btn').addEventListener('click', () => {
                    if (count > 1) count--;
                    qValue.textContent = count;
                });

                card.querySelector('.plus-btn').addEventListener('click', () => {
                    count++;
                    qValue.textContent = count;
                });
            });

            continueBtn.addEventListener('click', () => {
                if (!cart.length) {
                    continueBtn.classList.add('jiggle');
                    setTimeout(() => continueBtn.classList.remove('jiggle'), 300);
                    return;
                }
                selectedItemsContainer.innerHTML = '';
                cart.forEach(item => {
                    const original = document.querySelector(`[data-fruit="${item.name}"] img`);
                    const copy = original.cloneNode();
                    copy.className = 'w-16 h-16 object-contain rounded-full border border-red-500/50';
                    selectedItemsContainer.appendChild(copy);
                });
                nicknameModal.classList.add('visible');
                nicknameInput.focus();
            });

            closeNicknameModal.addEventListener('click', () => nicknameModal.classList.remove('visible'));

            generateBtn.addEventListener('click', () => {
                if (!nicknameInput.value.trim()) {
                    nicknameInput.classList.add('border-red-500');
                    return;
                }
                nicknameModal.classList.remove('visible');
                loadingModal.classList.add('visible');

                setTimeout(() => {
                    loadingModal.classList.remove('visible');
                    doneModal.classList.add('visible');
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#ffffff', '#ff0000', '#00ff00', '#ffd700']
                    });
                }, 2000);
            });

            closeModalBtn.addEventListener('click', () => {
                location.reload();
            });
        });
    </script>
</body>
</html>
